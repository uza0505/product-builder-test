<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>âš¡ 1ì´ˆ ì•ˆì— ì¡ì•„ë¼! - ë°˜ì‘ì†ë„ ê²Œì„</title>
  <style>
    :root {
      /* Dark Mode (Default) */
      --bg-gradient: radial-gradient(1200px 800px at 20% 10%, #2a2f5a 0%, #0b0f19 55%, #070a12 100%);
      --text-color: #e9efff;
      --text-muted: rgba(233,239,255,0.72);
      --text-dim: rgba(233,239,255,0.65);
      --text-hint: rgba(233,239,255,0.62);
      --panel-bg: rgba(255,255,255,0.06);
      --panel-border: rgba(255,255,255,0.12);
      --panel-shadow: rgba(0,0,0,0.35);
      --stat-bg: rgba(0,0,0,0.24);
      --stat-border: rgba(255,255,255,0.10);
      --toast-bg: rgba(0,0,0,0.55);
      --toast-border: rgba(255,255,255,0.14);
      --kbd-bg: rgba(255,255,255,0.07);
      --kbd-border: rgba(255,255,255,0.18);
      --kbd-text: rgba(233,239,255,0.86);
      --ghost-border: rgba(255,255,255,0.18);
      --miss-flash: rgba(255, 60, 60, 0.12);
    }

    [data-theme="light"] {
      --bg-gradient: radial-gradient(1200px 800px at 20% 10%, #e8eaf6 0%, #f5f5f5 55%, #ffffff 100%);
      --text-color: #1a1a2e;
      --text-muted: rgba(26,26,46,0.72);
      --text-dim: rgba(26,26,46,0.65);
      --text-hint: rgba(26,26,46,0.62);
      --panel-bg: rgba(255,255,255,0.85);
      --panel-border: rgba(0,0,0,0.12);
      --panel-shadow: rgba(0,0,0,0.15);
      --stat-bg: rgba(0,0,0,0.06);
      --stat-border: rgba(0,0,0,0.10);
      --toast-bg: rgba(255,255,255,0.92);
      --toast-border: rgba(0,0,0,0.14);
      --kbd-bg: rgba(0,0,0,0.07);
      --kbd-border: rgba(0,0,0,0.18);
      --kbd-text: rgba(26,26,46,0.86);
      --ghost-border: rgba(0,0,0,0.18);
      --miss-flash: rgba(255, 60, 60, 0.18);
    }

    * { box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans KR",Arial,sans-serif;
      background: var(--bg-gradient);
      color: var(--text-color);
      overflow:hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .wrap{ width:min(980px, 92vw); display:grid; grid-template-columns: 360px 1fr; gap:16px; }
    @media (max-width: 860px){ .wrap{ grid-template-columns: 1fr; } }
    .panel, .arena{
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: 18px;
      box-shadow: 0 18px 50px var(--panel-shadow);
      backdrop-filter: blur(8px);
      transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .panel{ padding:18px; }
    h1{ margin:0 0 10px; font-size:20px; letter-spacing:-0.3px; }
    .sub{ margin:0 0 14px; color: var(--text-muted); line-height:1.45; font-size:13px; }
    .stats{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px; }
    .stat{
      padding:12px; border-radius:14px;
      border:1px solid var(--stat-border);
      background: var(--stat-bg);
      transition: background 0.3s ease, border-color 0.3s ease;
    }
    .k{ font-size:12px; color: var(--text-dim); }
    .v{ margin-top:6px; font-size:20px; font-weight:900; }
    .v small{ font-size:12px; font-weight:700; color: var(--text-dim); }
    .btns{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    button{
      flex:1;
      padding:12px 12px;
      border:0;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      color:#071022;
      background: linear-gradient(135deg, #6d5efc, #3bc2ff);
      box-shadow: 0 10px 22px rgba(59,194,255,0.22);
      transition: transform .08s ease, filter .08s ease;
    }
    button:hover{ transform: translateY(-1px); filter: brightness(1.03); }
    button:active{ transform: translateY(0px); filter: brightness(0.98); }
    .ghost{
      background: transparent;
      color: var(--text-color);
      border:1px solid var(--ghost-border);
      box-shadow:none;
      flex: 0.8;
    }
    .hint{
      margin-top:12px;
      font-size:12px;
      color: var(--text-hint);
      line-height:1.5;
    }
    /* Theme Toggle Button */
    .theme-toggle{
      position: fixed;
      top: 16px;
      right: 16px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 1px solid var(--panel-border);
      background: var(--panel-bg);
      backdrop-filter: blur(8px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 4px 12px var(--panel-shadow);
      transition: transform 0.2s ease, background 0.3s ease;
      z-index: 100;
    }
    .theme-toggle:hover{
      transform: scale(1.08);
    }
    .theme-toggle:active{
      transform: scale(0.95);
    }
    .arena{
      position:relative;
      height: min(520px, 58vh);
      padding:0;
      overflow:hidden;
    }
    .arenaHeader{
      position:absolute; left:14px; top:12px; right:14px;
      display:flex; justify-content:space-between; align-items:center;
      pointer-events:none;
      color: var(--text-muted);
      font-weight:800;
      z-index:2;
    }
    .tag{ pointer-events:none; padding:6px 10px; border-radius:999px;
      border:1px solid var(--panel-border);
      background: var(--stat-bg);
      font-size:12px;
      transition: background 0.3s ease, border-color 0.3s ease;
    }

    /* Target */
    .target{
      position:absolute;
      width: 64px; height: 64px;
      border-radius: 50%;
      display:flex; align-items:center; justify-content:center;
      font-weight: 1000;
      color:#071022;
      user-select:none;
      cursor:pointer;
      background: radial-gradient(circle at 30% 25%, #fff4b8 0%, #ffd54f 40%, #ff9800 100%);
      box-shadow:
        0 18px 35px rgba(0,0,0,0.35),
        inset 0 2px 6px rgba(255,255,255,0.7),
        inset 0 -4px 10px rgba(0,0,0,0.18);
      transform: scale(0);
      animation: pop 180ms ease-out forwards;
      z-index:1;
    }
    @keyframes pop { to { transform: scale(1); } }
    .missFlash{
      position:absolute; inset:0;
      background: var(--miss-flash);
      opacity:0;
      transition: opacity .2s ease;
      z-index:0;
      pointer-events:none;
    }

    .toast{
      position:absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      padding: 12px 14px;
      border-radius: 14px;
      background: var(--toast-bg);
      border: 1px solid var(--toast-border);
      color: var(--text-color);
      font-weight:900;
      letter-spacing:-0.2px;
      opacity:0;
      transition: opacity .18s ease, transform .18s ease, background 0.3s ease;
      z-index:3;
      pointer-events:none;
      text-align:center;
      line-height:1.35;
    }
    .toast.show{
      opacity:1;
      transform: translate(-50%, -54%);
    }
    .kbd{
      display:inline-block;
      padding:2px 8px;
      border-radius:10px;
      border:1px solid var(--kbd-border);
      background: var(--kbd-bg);
      font-size:12px;
      font-weight:900;
      color: var(--kbd-text);
      margin-left:6px;
      transition: background 0.3s ease, border-color 0.3s ease;
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle" title="í…Œë§ˆ ë³€ê²½">ğŸŒ™</button>
  <div class="wrap">
    <div class="panel">
      <h1>âš¡ 1ì´ˆ ì•ˆì— ì¡ì•„ë¼!</h1>
      <p class="sub">
        ëœë¤ ì‹œê°„ì— íƒ€ê¹ƒì´ ë“±ì¥í•´ìš”. ëœ¨ëŠ” ìˆœê°„ <b>ë°”ë¡œ í´ë¦­</b>!<br>
        30ì´ˆ ë™ì•ˆ ìµœê³  ì ìˆ˜ì— ë„ì „í•˜ì„¸ìš”.
      </p>

      <div class="stats">
        <div class="stat">
          <div class="k">ì ìˆ˜</div>
          <div class="v" id="score">0</div>
        </div>
        <div class="stat">
          <div class="k">ë‚¨ì€ ì‹œê°„</div>
          <div class="v"><span id="time">30.0</span> <small>ì´ˆ</small></div>
        </div>
        <div class="stat">
          <div class="k">ì½¤ë³´</div>
          <div class="v" id="combo">0</div>
        </div>
        <div class="stat">
          <div class="k">ìµœê³  ì ìˆ˜</div>
          <div class="v" id="best">0</div>
        </div>
      </div>

      <div class="btns">
        <button id="startBtn">ê²Œì„ ì‹œì‘</button>
        <button class="ghost" id="resetBestBtn" title="ìµœê³  ì ìˆ˜ ì´ˆê¸°í™”">ê¸°ë¡ ì´ˆê¸°í™”</button>
      </div>

      <div class="hint">
        ğŸ’¡ íŒ: íƒ€ê¹ƒì€ ìµœëŒ€ <b>1ì´ˆ</b> ë™ì•ˆë§Œ ìˆì–´ìš”. ëŠ¦ìœ¼ë©´ ì‹¤íŒ¨!<br>
        PC: í´ë¦­ / ëª¨ë°”ì¼: í„°ì¹˜<br>
        <span class="kbd">Space</span>ë¡œë„ ì‹œì‘ ê°€ëŠ¥
      </div>
    </div>

    <div class="arena" id="arena">
      <div class="arenaHeader">
        <div class="tag">ğŸ¯ ëœ¨ë©´ ë°”ë¡œ ëˆŒëŸ¬!</div>
        <div class="tag">â±ï¸ 30ì´ˆ ìŠ¤í”¼ë“œëŸ°</div>
      </div>
      <div class="missFlash" id="missFlash"></div>
      <div class="toast" id="toast"></div>
    </div>
  </div>

<script>
  const arena = document.getElementById("arena");
  const scoreEl = document.getElementById("score");
  const comboEl = document.getElementById("combo");
  const timeEl  = document.getElementById("time");
  const bestEl  = document.getElementById("best");
  const toast   = document.getElementById("toast");
  const missFlash = document.getElementById("missFlash");
  const startBtn = document.getElementById("startBtn");
  const resetBestBtn = document.getElementById("resetBestBtn");

  const BEST_KEY = "REACTION_BEST_V1";

  let running = false;
  let score = 0;
  let combo = 0;
  let best = Number(localStorage.getItem(BEST_KEY) || 0);
  bestEl.textContent = best;

  let tLeft = 30_000; // ms
  let timerId = null;
  let spawnId = null;
  let targetEl = null;
  let spawnAt = 0;
  let targetTimeout = null;

  function showToast(text){
    toast.innerHTML = text;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 900);
  }

  function flashMiss(){
    missFlash.style.opacity = 1;
    setTimeout(()=>missFlash.style.opacity = 0, 180);
  }

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function placeTarget() {
    clearTimeout(targetTimeout);
    removeTarget();

    const rect = arena.getBoundingClientRect();
    const size = 64;
    const pad = 16 + 10; // header area safety
    const x = Math.random() * (rect.width - size - pad*2) + pad;
    const y = Math.random() * (rect.height - size - pad*2) + pad;

    targetEl = document.createElement("div");
    targetEl.className = "target";
    targetEl.setAttribute("role","button");
    targetEl.setAttribute("aria-label","target");

    targetEl.style.left = `${x}px`;
    targetEl.style.top  = `${y}px`;

    // í´ë¦­ ì²˜ë¦¬
    targetEl.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      if (!running) return;

      const rt = performance.now() - spawnAt; // ms
      const rtMs = Math.round(rt);

      // ì ìˆ˜: ê¸°ë³¸ 1ì  + ë¹ ë¥´ë©´ ë³´ë„ˆìŠ¤
      const bonus = rt < 220 ? 2 : rt < 350 ? 1 : 0;
      score += 1 + bonus;

      combo += 1;

      scoreEl.textContent = score;
      comboEl.textContent = combo;

      showToast(`âœ… ${rtMs}ms<br><span style="color:rgba(233,239,255,0.7);font-weight:800;">+${1+bonus}ì </span>`);
      removeTarget();
      scheduleSpawn();
    });

    arena.appendChild(targetEl);

    spawnAt = performance.now();

    // 1ì´ˆ ì•ˆì— ëª» ëˆ„ë¥´ë©´ ì‹¤íŒ¨
    targetTimeout = setTimeout(() => {
      if (!running) return;
      combo = 0;
      comboEl.textContent = combo;
      flashMiss();
      showToast("â›” ëŠ¦ì—ˆì–´!");
      removeTarget();
      scheduleSpawn();
    }, 1000);
  }

  function removeTarget() {
    if (targetEl && targetEl.parentNode) targetEl.parentNode.removeChild(targetEl);
    targetEl = null;
    clearTimeout(targetTimeout);
    targetTimeout = null;
  }

  function scheduleSpawn() {
    clearTimeout(spawnId);
    if (!running) return;

    // ëœë¤ ë”œë ˆì´: 200~900ms (ê²Œì„ì´ ì§€ë£¨í•˜ì§€ ì•Šê²Œ)
    const delay = Math.floor(200 + Math.random() * 700);
    spawnId = setTimeout(placeTarget, delay);
  }

  function startGame() {
    if (running) return;
    running = true;

    score = 0;
    combo = 0;
    tLeft = 30_000;

    scoreEl.textContent = score;
    comboEl.textContent = combo;
    timeEl.textContent = (tLeft/1000).toFixed(1);

    showToast("ì‹œì‘! ğŸ¯");
    startBtn.textContent = "ì§„í–‰ ì¤‘â€¦";

    const startAt = performance.now();

    clearInterval(timerId);
    timerId = setInterval(() => {
      const elapsed = performance.now() - startAt;
      const left = clamp(30_000 - elapsed, 0, 30_000);
      tLeft = left;
      timeEl.textContent = (left/1000).toFixed(1);

      if (left <= 0) endGame();
    }, 50);

    scheduleSpawn();
  }

  function endGame() {
    if (!running) return;
    running = false;

    clearInterval(timerId);
    clearTimeout(spawnId);
    removeTarget();

    if (score > best) {
      best = score;
      localStorage.setItem(BEST_KEY, String(best));
      bestEl.textContent = best;
      showToast(`ğŸ† ì‹ ê¸°ë¡!<br>${score}ì `);
    } else {
      showToast(`ë!<br>${score}ì `);
    }
    startBtn.textContent = "ë‹¤ì‹œ ì‹œì‘";
  }

  startBtn.addEventListener("click", startGame);
  resetBestBtn.addEventListener("click", () => {
    localStorage.removeItem(BEST_KEY);
    best = 0;
    bestEl.textContent = best;
    showToast("ê¸°ë¡ ì´ˆê¸°í™” ì™„ë£Œ");
  });

  // Spaceë¡œ ì‹œì‘
  window.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
      e.preventDefault();
      startGame();
    }
  });

  // ì²˜ìŒ ì•ˆë‚´
  showToast("ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘!");

  // Theme Toggle
  const THEME_KEY = "REACTION_THEME_V1";
  const themeToggle = document.getElementById("themeToggle");

  function setTheme(theme) {
    document.documentElement.setAttribute("data-theme", theme);
    themeToggle.textContent = theme === "light" ? "â˜€ï¸" : "ğŸŒ™";
    localStorage.setItem(THEME_KEY, theme);
  }

  function toggleTheme() {
    const current = document.documentElement.getAttribute("data-theme");
    const next = current === "light" ? "dark" : "light";
    setTheme(next);
  }

  // Initialize theme from localStorage or default to dark
  const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
  setTheme(savedTheme);

  themeToggle.addEventListener("click", toggleTheme);
</script>
</body>
</html>
